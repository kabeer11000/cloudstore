var{defineProperty:e,getOwnPropertyNames:X4,getOwnPropertyDescriptor:z4}=Object,M4=Object.prototype.hasOwnProperty;var L1=new WeakMap,G4=(I)=>{var Q=L1.get(I),$;if(Q)return Q;if(Q=e({},"__esModule",{value:!0}),I&&typeof I==="object"||typeof I==="function")X4(I).map((Z)=>!M4.call(Q,Z)&&e(Q,Z,{get:()=>I[Z],enumerable:!($=z4(I,Z))||$.enumerable}));return L1.set(I,Q),Q};var I1=(I,Q)=>{for(var $ in Q)e(I,$,{get:Q[$],enumerable:!0,configurable:!0,set:(Z)=>Q[$]=()=>Z})};var f4={};I1(f4,{default:()=>C1,Types:()=>O4,Adapters:()=>W1});module.exports=G4(f4);var D=Object.create(null);D.open="0";D.close="1";D.ping="2";D.pong="3";D.message="4";D.upgrade="5";D.noop="6";var R=Object.create(null);Object.keys(D).forEach((I)=>{R[D[I]]=I});var E={type:"error",data:"parser error"};var N1=typeof Blob==="function"||typeof Blob!=="undefined"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",x1=typeof ArrayBuffer==="function",q1=(I)=>{return typeof ArrayBuffer.isView==="function"?ArrayBuffer.isView(I):I&&I.buffer instanceof ArrayBuffer},S=({type:I,data:Q},$,Z)=>{if(N1&&Q instanceof Blob)if($)return Z(Q);else return B1(Q,Z);else if(x1&&(Q instanceof ArrayBuffer||q1(Q)))if($)return Z(Q);else return B1(new Blob([Q]),Z);return Z(D[I]+(Q||""))},B1=(I,Q)=>{let $=new FileReader;return $.onload=function(){let Z=$.result.split(",")[1];Q("b"+(Z||""))},$.readAsDataURL(I)};function A1(I){if(I instanceof Uint8Array)return I;else if(I instanceof ArrayBuffer)return new Uint8Array(I);else return new Uint8Array(I.buffer,I.byteOffset,I.byteLength)}var Q1;function _1(I,Q){if(N1&&I.data instanceof Blob)return I.data.arrayBuffer().then(A1).then(Q);else if(x1&&(I.data instanceof ArrayBuffer||q1(I.data)))return Q(A1(I.data));S(I,!1,($)=>{if(!Q1)Q1=new TextEncoder;Q(Q1.encode($))})}var v=typeof Uint8Array==="undefined"?[]:new Uint8Array(256);for(let I=0;I<"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".length;I++)v["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(I)]=I;var m1=(I)=>{let Q=I.length*0.75,$=I.length,Z,J=0,Y,K,z,M;if(I[I.length-1]==="="){if(Q--,I[I.length-2]==="=")Q--}let V=new ArrayBuffer(Q),U=new Uint8Array(V);for(Z=0;Z<$;Z+=4)Y=v[I.charCodeAt(Z)],K=v[I.charCodeAt(Z+1)],z=v[I.charCodeAt(Z+2)],M=v[I.charCodeAt(Z+3)],U[J++]=Y<<2|K>>4,U[J++]=(K&15)<<4|z>>2,U[J++]=(z&3)<<6|M&63;return V};var U4=typeof ArrayBuffer==="function",P=(I,Q)=>{if(typeof I!=="string")return{type:"message",data:R1(I,Q)};let $=I.charAt(0);if($==="b")return{type:"message",data:w4(I.substring(1),Q)};if(!R[$])return E;return I.length>1?{type:R[$],data:I.substring(1)}:{type:R[$]}},w4=(I,Q)=>{if(U4){let $=m1(I);return R1($,Q)}else return{base64:!0,data:I}},R1=(I,Q)=>{switch(Q){case"blob":if(I instanceof Blob)return I;else return new Blob([I]);case"arraybuffer":default:if(I instanceof ArrayBuffer)return I;else return I.buffer}};var E1=String.fromCharCode(30),S1=(I,Q)=>{let $=I.length,Z=new Array($),J=0;I.forEach((Y,K)=>{S(Y,!1,(z)=>{if(Z[K]=z,++J===$)Q(Z.join(E1))})})},v1=(I,Q)=>{let $=I.split(E1),Z=[];for(let J=0;J<$.length;J++){let Y=P($[J],Q);if(Z.push(Y),Y.type==="error")break}return Z};function P1(){return new TransformStream({transform(I,Q){_1(I,($)=>{let Z=$.length,J;if(Z<126)J=new Uint8Array(1),new DataView(J.buffer).setUint8(0,Z);else if(Z<65536){J=new Uint8Array(3);let Y=new DataView(J.buffer);Y.setUint8(0,126),Y.setUint16(1,Z)}else{J=new Uint8Array(9);let Y=new DataView(J.buffer);Y.setUint8(0,127),Y.setBigUint64(1,BigInt(Z))}if(I.data&&typeof I.data!=="string")J[0]|=128;Q.enqueue(J),Q.enqueue($)})}})}var $1;function b(I){return I.reduce((Q,$)=>Q+$.length,0)}function n(I,Q){if(I[0].length===Q)return I.shift();let $=new Uint8Array(Q),Z=0;for(let J=0;J<Q;J++)if($[J]=I[0][Z++],Z===I[0].length)I.shift(),Z=0;if(I.length&&Z<I[0].length)I[0]=I[0].slice(Z);return $}function h1(I,Q){if(!$1)$1=new TextDecoder;let $=[],Z=0,J=-1,Y=!1;return new TransformStream({transform(K,z){$.push(K);while(!0){if(Z===0){if(b($)<1)break;let M=n($,1);if(Y=(M[0]&128)===128,J=M[0]&127,J<126)Z=3;else if(J===126)Z=1;else Z=2}else if(Z===1){if(b($)<2)break;let M=n($,2);J=new DataView(M.buffer,M.byteOffset,M.length).getUint16(0),Z=3}else if(Z===2){if(b($)<8)break;let M=n($,8),V=new DataView(M.buffer,M.byteOffset,M.length),U=V.getUint32(0);if(U>Math.pow(2,21)-1){z.enqueue(E);break}J=U*Math.pow(2,32)+V.getUint32(4),Z=3}else{if(b($)<J)break;let M=n($,J);z.enqueue(P(Y?M:$1.decode(M),Q)),Z=0}if(J===0||J>I){z.enqueue(E);break}}}})}var Z1=4;function X(I){if(I)return F4(I)}function F4(I){for(var Q in X.prototype)I[Q]=X.prototype[Q];return I}X.prototype.on=X.prototype.addEventListener=function(I,Q){return this._callbacks=this._callbacks||{},(this._callbacks["$"+I]=this._callbacks["$"+I]||[]).push(Q),this};X.prototype.once=function(I,Q){function $(){this.off(I,$),Q.apply(this,arguments)}return $.fn=Q,this.on(I,$),this};X.prototype.off=X.prototype.removeListener=X.prototype.removeAllListeners=X.prototype.removeEventListener=function(I,Q){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var $=this._callbacks["$"+I];if(!$)return this;if(arguments.length==1)return delete this._callbacks["$"+I],this;var Z;for(var J=0;J<$.length;J++)if(Z=$[J],Z===Q||Z.fn===Q){$.splice(J,1);break}if($.length===0)delete this._callbacks["$"+I];return this};X.prototype.emit=function(I){this._callbacks=this._callbacks||{};var Q=new Array(arguments.length-1),$=this._callbacks["$"+I];for(var Z=1;Z<arguments.length;Z++)Q[Z-1]=arguments[Z];if($){$=$.slice(0);for(var Z=0,J=$.length;Z<J;++Z)$[Z].apply(this,Q)}return this};X.prototype.emitReserved=X.prototype.emit;X.prototype.listeners=function(I){return this._callbacks=this._callbacks||{},this._callbacks["$"+I]||[]};X.prototype.hasListeners=function(I){return!!this.listeners(I).length};var C=(()=>{if(typeof Promise==="function"&&typeof Promise.resolve==="function")return(Q)=>Promise.resolve().then(Q);else return(Q,$)=>$(Q,0)})(),w=(()=>{if(typeof self!=="undefined")return self;else if(typeof window!=="undefined")return window;else return Function("return this")()})(),g1="arraybuffer";function T1(){}function i(I,...Q){return Q.reduce(($,Z)=>{if(I.hasOwnProperty(Z))$[Z]=I[Z];return $},{})}var V4=w.setTimeout,D4=w.clearTimeout;function L(I,Q){if(Q.useNativeTimers)I.setTimeoutFn=V4.bind(w),I.clearTimeoutFn=D4.bind(w);else I.setTimeoutFn=w.setTimeout.bind(w),I.clearTimeoutFn=w.clearTimeout.bind(w)}var H4=1.33;function f1(I){if(typeof I==="string")return W4(I);return Math.ceil((I.byteLength||I.size)*H4)}function W4(I){let Q=0,$=0;for(let Z=0,J=I.length;Z<J;Z++)if(Q=I.charCodeAt(Z),Q<128)$+=1;else if(Q<2048)$+=2;else if(Q<55296||Q>=57344)$+=3;else Z++,$+=4;return $}function d(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function j1(I){let Q="";for(let $ in I)if(I.hasOwnProperty($)){if(Q.length)Q+="&";Q+=encodeURIComponent($)+"="+encodeURIComponent(I[$])}return Q}function y1(I){let Q={},$=I.split("&");for(let Z=0,J=$.length;Z<J;Z++){let Y=$[Z].split("=");Q[decodeURIComponent(Y[0])]=decodeURIComponent(Y[1])}return Q}class J1 extends Error{constructor(I,Q,$){super(I);this.description=Q,this.context=$,this.type="TransportError"}}class A extends X{constructor(I){super();this.writable=!1,L(this,I),this.opts=I,this.query=I.query,this.socket=I.socket,this.supportsBinary=!I.forceBase64}onError(I,Q,$){return super.emitReserved("error",new J1(I,Q,$)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){if(this.readyState==="opening"||this.readyState==="open")this.doClose(),this.onClose();return this}send(I){if(this.readyState==="open")this.write(I)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(I){let Q=P(I,this.socket.binaryType);this.onPacket(Q)}onPacket(I){super.emitReserved("packet",I)}onClose(I){this.readyState="closed",super.emitReserved("close",I)}pause(I){}createUri(I,Q={}){return I+"://"+this._hostname()+this._port()+this.opts.path+this._query(Q)}_hostname(){let I=this.opts.hostname;return I.indexOf(":")===-1?I:"["+I+"]"}_port(){if(this.opts.port&&(this.opts.secure&&Number(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80))return":"+this.opts.port;else return""}_query(I){let Q=j1(I);return Q.length?"?"+Q:""}}class k extends A{constructor(){super(...arguments);this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(I){this.readyState="pausing";let Q=()=>{this.readyState="paused",I()};if(this._polling||!this.writable){let $=0;if(this._polling)$++,this.once("pollComplete",function(){--$||Q()});if(!this.writable)$++,this.once("drain",function(){--$||Q()})}else Q()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(I){let Q=($)=>{if(this.readyState==="opening"&&$.type==="open")this.onOpen();if($.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket($)};if(v1(I,this.socket.binaryType).forEach(Q),this.readyState!=="closed"){if(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open")this._poll()}}doClose(){let I=()=>{this.write([{type:"close"}])};if(this.readyState==="open")I();else this.once("open",I)}write(I){this.writable=!1,S1(I,(Q)=>{this.doWrite(Q,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let I=this.opts.secure?"https":"http",Q=this.query||{};if(this.opts.timestampRequests!==!1)Q[this.opts.timestampParam]=d();if(!this.supportsBinary&&!Q.sid)Q.b64=1;return this.createUri(I,Q)}}var l1=!1;try{l1=typeof XMLHttpRequest!=="undefined"&&"withCredentials"in new XMLHttpRequest}catch(I){}var u1=l1;function C4(){}class n1 extends k{constructor(I){super(I);if(typeof location!=="undefined"){let Q=location.protocol==="https:",$=location.port;if(!$)$=Q?"443":"80";this.xd=typeof location!=="undefined"&&I.hostname!==location.hostname||$!==I.port}}doWrite(I,Q){let $=this.request({method:"POST",data:I});$.on("success",Q),$.on("error",(Z,J)=>{this.onError("xhr post error",Z,J)})}doPoll(){let I=this.request();I.on("data",this.onData.bind(this)),I.on("error",(Q,$)=>{this.onError("xhr poll error",Q,$)}),this.pollXhr=I}}class W extends X{constructor(I,Q,$){super();this.createRequest=I,L(this,$),this._opts=$,this._method=$.method||"GET",this._uri=Q,this._data=$.data!==void 0?$.data:null,this._create()}_create(){var I;let Q=i(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");Q.xdomain=!!this._opts.xd;let $=this._xhr=this.createRequest(Q);try{$.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){$.setDisableHeaderCheck&&$.setDisableHeaderCheck(!0);for(let Z in this._opts.extraHeaders)if(this._opts.extraHeaders.hasOwnProperty(Z))$.setRequestHeader(Z,this._opts.extraHeaders[Z])}}catch(Z){}if(this._method==="POST")try{$.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(Z){}try{$.setRequestHeader("Accept","*/*")}catch(Z){}if((I=this._opts.cookieJar)===null||I===void 0||I.addCookies($),"withCredentials"in $)$.withCredentials=this._opts.withCredentials;if(this._opts.requestTimeout)$.timeout=this._opts.requestTimeout;$.onreadystatechange=()=>{var Z;if($.readyState===3)(Z=this._opts.cookieJar)===null||Z===void 0||Z.parseCookies($.getResponseHeader("set-cookie"));if($.readyState!==4)return;if($.status===200||$.status===1223)this._onLoad();else this.setTimeoutFn(()=>{this._onError(typeof $.status==="number"?$.status:0)},0)},$.send(this._data)}catch(Z){this.setTimeoutFn(()=>{this._onError(Z)},0);return}if(typeof document!=="undefined")this._index=W.requestsCount++,W.requests[this._index]=this}_onError(I){this.emitReserved("error",I,this._xhr),this._cleanup(!0)}_cleanup(I){if(typeof this._xhr==="undefined"||this._xhr===null)return;if(this._xhr.onreadystatechange=C4,I)try{this._xhr.abort()}catch(Q){}if(typeof document!=="undefined")delete W.requests[this._index];this._xhr=null}_onLoad(){let I=this._xhr.responseText;if(I!==null)this.emitReserved("data",I),this.emitReserved("success"),this._cleanup()}abort(){this._cleanup()}}W.requestsCount=0;W.requests={};if(typeof document!=="undefined"){if(typeof attachEvent==="function")attachEvent("onunload",b1);else if(typeof addEventListener==="function"){let I="onpagehide"in w?"pagehide":"unload";addEventListener(I,b1,!1)}}function b1(){for(let I in W.requests)if(W.requests.hasOwnProperty(I))W.requests[I].abort()}var L4=function(){let I=i1({xdomain:!1});return I&&I.responseType!==null}();class N extends n1{constructor(I){super(I);let Q=I&&I.forceBase64;this.supportsBinary=L4&&!Q}request(I={}){return Object.assign(I,{xd:this.xd},this.opts),new W(i1,this.uri(),I)}}function i1(I){let Q=I.xdomain;try{if(typeof XMLHttpRequest!=="undefined"&&(!Q||u1))return new XMLHttpRequest}catch($){}if(!Q)try{return new w[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch($){}}var d1=typeof navigator!=="undefined"&&typeof navigator.product==="string"&&navigator.product.toLowerCase()==="reactnative";class k1 extends A{get name(){return"websocket"}doOpen(){let I=this.uri(),Q=this.opts.protocols,$=d1?{}:i(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");if(this.opts.extraHeaders)$.headers=this.opts.extraHeaders;try{this.ws=this.createSocket(I,Q,$)}catch(Z){return this.emitReserved("error",Z)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{if(this.opts.autoUnref)this.ws._socket.unref();this.onOpen()},this.ws.onclose=(I)=>this.onClose({description:"websocket connection closed",context:I}),this.ws.onmessage=(I)=>this.onData(I.data),this.ws.onerror=(I)=>this.onError("websocket error",I)}write(I){this.writable=!1;for(let Q=0;Q<I.length;Q++){let $=I[Q],Z=Q===I.length-1;S($,this.supportsBinary,(J)=>{try{this.doWrite($,J)}catch(Y){}if(Z)C(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){if(typeof this.ws!=="undefined")this.ws.onerror=()=>{},this.ws.close(),this.ws=null}uri(){let I=this.opts.secure?"wss":"ws",Q=this.query||{};if(this.opts.timestampRequests)Q[this.opts.timestampParam]=d();if(!this.supportsBinary)Q.b64=1;return this.createUri(I,Q)}}var Y1=w.WebSocket||w.MozWebSocket;class x extends k1{createSocket(I,Q,$){return!d1?Q?new Y1(I,Q):new Y1(I):new Y1(I,Q,$)}doWrite(I,Q){this.ws.send(Q)}}class h extends A{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(I){return this.emitReserved("error",I)}this._transport.closed.then(()=>{this.onClose()}).catch((I)=>{this.onError("webtransport error",I)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then((I)=>{let Q=h1(Number.MAX_SAFE_INTEGER,this.socket.binaryType),$=I.readable.pipeThrough(Q).getReader(),Z=P1();Z.readable.pipeTo(I.writable),this._writer=Z.writable.getWriter();let J=()=>{$.read().then(({done:K,value:z})=>{if(K)return;this.onPacket(z),J()}).catch((K)=>{})};J();let Y={type:"open"};if(this.query.sid)Y.data=`{"sid":"${this.query.sid}"}`;this._writer.write(Y).then(()=>this.onOpen())})})}write(I){this.writable=!1;for(let Q=0;Q<I.length;Q++){let $=I[Q],Z=Q===I.length-1;this._writer.write($).then(()=>{if(Z)C(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var I;(I=this._transport)===null||I===void 0||I.close()}}var K1={websocket:x,webtransport:h,polling:N};var B4=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,A4=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function _(I){if(I.length>8000)throw"URI too long";let Q=I,$=I.indexOf("["),Z=I.indexOf("]");if($!=-1&&Z!=-1)I=I.substring(0,$)+I.substring($,Z).replace(/:/g,";")+I.substring(Z,I.length);let J=B4.exec(I||""),Y={},K=14;while(K--)Y[A4[K]]=J[K]||"";if($!=-1&&Z!=-1)Y.source=Q,Y.host=Y.host.substring(1,Y.host.length-1).replace(/;/g,":"),Y.authority=Y.authority.replace("[","").replace("]","").replace(/;/g,":"),Y.ipv6uri=!0;return Y.pathNames=N4(Y,Y.path),Y.queryKey=x4(Y,Y.query),Y}function N4(I,Q){let $=/\/{2,9}/g,Z=Q.replace($,"/").split("/");if(Q.slice(0,1)=="/"||Q.length===0)Z.splice(0,1);if(Q.slice(-1)=="/")Z.splice(Z.length-1,1);return Z}function x4(I,Q){let $={};return Q.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(Z,J,Y){if(J)$[J]=Y}),$}var O1=typeof addEventListener==="function"&&typeof removeEventListener==="function",c=[];if(O1)addEventListener("offline",()=>{c.forEach((I)=>I())},!1);class B extends X{constructor(I,Q){super();if(this.binaryType=g1,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,I&&typeof I==="object")Q=I,I=null;if(I){let $=_(I);if(Q.hostname=$.host,Q.secure=$.protocol==="https"||$.protocol==="wss",Q.port=$.port,$.query)Q.query=$.query}else if(Q.host)Q.hostname=_(Q.host).host;if(L(this,Q),this.secure=Q.secure!=null?Q.secure:typeof location!=="undefined"&&location.protocol==="https:",Q.hostname&&!Q.port)Q.port=this.secure?"443":"80";if(this.hostname=Q.hostname||(typeof location!=="undefined"?location.hostname:"localhost"),this.port=Q.port||(typeof location!=="undefined"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},Q.transports.forEach(($)=>{let Z=$.prototype.name;this.transports.push(Z),this._transportsByName[Z]=$}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},Q),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query==="string")this.opts.query=y1(this.opts.query);if(O1){if(this.opts.closeOnBeforeunload)this._beforeunloadEventListener=()=>{if(this.transport)this.transport.removeAllListeners(),this.transport.close()},addEventListener("beforeunload",this._beforeunloadEventListener,!1);if(this.hostname!=="localhost")this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},c.push(this._offlineEventListener)}if(this.opts.withCredentials)this._cookieJar=T1();this._open()}createTransport(I){let Q=Object.assign({},this.opts.query);if(Q.EIO=Z1,Q.transport=I,this.id)Q.sid=this.id;let $=Object.assign({},this.opts,{query:Q,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[I]);return new this._transportsByName[I]($)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}let I=this.opts.rememberUpgrade&&B.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";let Q=this.createTransport(I);Q.open(),this.setTransport(Q)}setTransport(I){if(this.transport)this.transport.removeAllListeners();this.transport=I,I.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",(Q)=>this._onClose("transport close",Q))}onOpen(){this.readyState="open",B.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(I){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",I),this.emitReserved("heartbeat"),I.type){case"open":this.onHandshake(JSON.parse(I.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":let Q=new Error("server error");Q.code=I.data,this._onError(Q);break;case"message":this.emitReserved("data",I.data),this.emitReserved("message",I.data);break}}onHandshake(I){if(this.emitReserved("handshake",I),this.id=I.sid,this.transport.query.sid=I.sid,this._pingInterval=I.pingInterval,this._pingTimeout=I.pingTimeout,this._maxPayload=I.maxPayload,this.onOpen(),this.readyState==="closed")return;this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);let I=this._pingInterval+this._pingTimeout;if(this._pingTimeoutTime=Date.now()+I,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},I),this.opts.autoUnref)this._pingTimeoutTimer.unref()}_onDrain(){if(this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0)this.emitReserved("drain");else this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){let I=this._getWritablePackets();this.transport.send(I),this._prevBufferLen=I.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let Q=1;for(let $=0;$<this.writeBuffer.length;$++){let Z=this.writeBuffer[$].data;if(Z)Q+=f1(Z);if($>0&&Q>this._maxPayload)return this.writeBuffer.slice(0,$);Q+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;let I=Date.now()>this._pingTimeoutTime;if(I)this._pingTimeoutTime=0,C(()=>{this._onClose("ping timeout")},this.setTimeoutFn);return I}write(I,Q,$){return this._sendPacket("message",I,Q,$),this}send(I,Q,$){return this._sendPacket("message",I,Q,$),this}_sendPacket(I,Q,$,Z){if(typeof Q==="function")Z=Q,Q=void 0;if(typeof $==="function")Z=$,$=null;if(this.readyState==="closing"||this.readyState==="closed")return;$=$||{},$.compress=$.compress!==!1;let J={type:I,data:Q,options:$};if(this.emitReserved("packetCreate",J),this.writeBuffer.push(J),Z)this.once("flush",Z);this.flush()}close(){let I=()=>{this._onClose("forced close"),this.transport.close()},Q=()=>{this.off("upgrade",Q),this.off("upgradeError",Q),I()},$=()=>{this.once("upgrade",Q),this.once("upgradeError",Q)};if(this.readyState==="opening"||this.readyState==="open")if(this.readyState="closing",this.writeBuffer.length)this.once("drain",()=>{if(this.upgrading)$();else I()});else if(this.upgrading)$();else I();return this}_onError(I){if(B.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",I),this._onClose("transport error",I)}_onClose(I,Q){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),O1){if(this._beforeunloadEventListener)removeEventListener("beforeunload",this._beforeunloadEventListener,!1);if(this._offlineEventListener){let $=c.indexOf(this._offlineEventListener);if($!==-1)c.splice($,1)}}this.readyState="closed",this.id=null,this.emitReserved("close",I,Q),this.writeBuffer=[],this._prevBufferLen=0}}}B.protocol=Z1;class X1 extends B{constructor(){super(...arguments);this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let I=0;I<this._upgrades.length;I++)this._probe(this._upgrades[I])}_probe(I){let Q=this.createTransport(I),$=!1;B.priorWebsocketSuccess=!1;let Z=()=>{if($)return;Q.send([{type:"ping",data:"probe"}]),Q.once("packet",(U)=>{if($)return;if(U.type==="pong"&&U.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",Q),!Q)return;B.priorWebsocketSuccess=Q.name==="websocket",this.transport.pause(()=>{if($)return;if(this.readyState==="closed")return;V(),this.setTransport(Q),Q.send([{type:"upgrade"}]),this.emitReserved("upgrade",Q),Q=null,this.upgrading=!1,this.flush()})}else{let m=new Error("probe error");m.transport=Q.name,this.emitReserved("upgradeError",m)}})};function J(){if($)return;$=!0,V(),Q.close(),Q=null}let Y=(U)=>{let m=new Error("probe error: "+U);m.transport=Q.name,J(),this.emitReserved("upgradeError",m)};function K(){Y("transport closed")}function z(){Y("socket closed")}function M(U){if(Q&&U.name!==Q.name)J()}let V=()=>{Q.removeListener("open",Z),Q.removeListener("error",Y),Q.removeListener("close",K),this.off("close",z),this.off("upgrading",M)};if(Q.once("open",Z),Q.once("error",Y),Q.once("close",K),this.once("close",z),this.once("upgrading",M),this._upgrades.indexOf("webtransport")!==-1&&I!=="webtransport")this.setTimeoutFn(()=>{if(!$)Q.open()},200);else Q.open()}onHandshake(I){this._upgrades=this._filterUpgrades(I.upgrades),super.onHandshake(I)}_filterUpgrades(I){let Q=[];for(let $=0;$<I.length;$++)if(~this.transports.indexOf(I[$]))Q.push(I[$]);return Q}}class g extends X1{constructor(I,Q={}){let $=typeof I==="object"?I:Q;if(!$.transports||$.transports&&typeof $.transports[0]==="string")$.transports=($.transports||["polling","websocket","webtransport"]).map((Z)=>K1[Z]).filter((Z)=>!!Z);super(I,$)}}var b0=g.protocol;function c1(I,Q="",$){let Z=I;if($=$||typeof location!=="undefined"&&location,I==null)I=$.protocol+"//"+$.host;if(typeof I==="string"){if(I.charAt(0)==="/")if(I.charAt(1)==="/")I=$.protocol+I;else I=$.host+I;if(!/^(https?|wss?):\/\//.test(I))if(typeof $!=="undefined")I=$.protocol+"//"+I;else I="https://"+I;Z=_(I)}if(!Z.port){if(/^(http|ws)$/.test(Z.protocol))Z.port="80";else if(/^(http|ws)s$/.test(Z.protocol))Z.port="443"}Z.path=Z.path||"/";let Y=Z.host.indexOf(":")!==-1?"["+Z.host+"]":Z.host;return Z.id=Z.protocol+"://"+Y+":"+Z.port+Q,Z.href=Z.protocol+"://"+Y+($&&$.port===Z.port?"":":"+Z.port),Z}var U1={};I1(U1,{protocol:()=>t1,PacketType:()=>O,Encoder:()=>a1,Decoder:()=>G1});var _4=typeof ArrayBuffer==="function",m4=(I)=>{return typeof ArrayBuffer.isView==="function"?ArrayBuffer.isView(I):I.buffer instanceof ArrayBuffer},p1=Object.prototype.toString,R4=typeof Blob==="function"||typeof Blob!=="undefined"&&p1.call(Blob)==="[object BlobConstructor]",E4=typeof File==="function"||typeof File!=="undefined"&&p1.call(File)==="[object FileConstructor]";function f(I){return _4&&(I instanceof ArrayBuffer||m4(I))||R4&&I instanceof Blob||E4&&I instanceof File}function T(I,Q){if(!I||typeof I!=="object")return!1;if(Array.isArray(I)){for(let $=0,Z=I.length;$<Z;$++)if(T(I[$]))return!0;return!1}if(f(I))return!0;if(I.toJSON&&typeof I.toJSON==="function"&&arguments.length===1)return T(I.toJSON(),!0);for(let $ in I)if(Object.prototype.hasOwnProperty.call(I,$)&&T(I[$]))return!0;return!1}function r1(I){let Q=[],$=I.data,Z=I;return Z.data=z1($,Q),Z.attachments=Q.length,{packet:Z,buffers:Q}}function z1(I,Q){if(!I)return I;if(f(I)){let $={_placeholder:!0,num:Q.length};return Q.push(I),$}else if(Array.isArray(I)){let $=new Array(I.length);for(let Z=0;Z<I.length;Z++)$[Z]=z1(I[Z],Q);return $}else if(typeof I==="object"&&!(I instanceof Date)){let $={};for(let Z in I)if(Object.prototype.hasOwnProperty.call(I,Z))$[Z]=z1(I[Z],Q);return $}return I}function s1(I,Q){return I.data=M1(I.data,Q),delete I.attachments,I}function M1(I,Q){if(!I)return I;if(I&&I._placeholder===!0)if(typeof I.num==="number"&&I.num>=0&&I.num<Q.length)return Q[I.num];else throw new Error("illegal attachments");else if(Array.isArray(I))for(let $=0;$<I.length;$++)I[$]=M1(I[$],Q);else if(typeof I==="object"){for(let $ in I)if(Object.prototype.hasOwnProperty.call(I,$))I[$]=M1(I[$],Q)}return I}var S4=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],t1=5,O;(function(I){I[I.CONNECT=0]="CONNECT",I[I.DISCONNECT=1]="DISCONNECT",I[I.EVENT=2]="EVENT",I[I.ACK=3]="ACK",I[I.CONNECT_ERROR=4]="CONNECT_ERROR",I[I.BINARY_EVENT=5]="BINARY_EVENT",I[I.BINARY_ACK=6]="BINARY_ACK"})(O||(O={}));class a1{constructor(I){this.replacer=I}encode(I){if(I.type===O.EVENT||I.type===O.ACK){if(T(I))return this.encodeAsBinary({type:I.type===O.EVENT?O.BINARY_EVENT:O.BINARY_ACK,nsp:I.nsp,data:I.data,id:I.id})}return[this.encodeAsString(I)]}encodeAsString(I){let Q=""+I.type;if(I.type===O.BINARY_EVENT||I.type===O.BINARY_ACK)Q+=I.attachments+"-";if(I.nsp&&I.nsp!=="/")Q+=I.nsp+",";if(I.id!=null)Q+=I.id;if(I.data!=null)Q+=JSON.stringify(I.data,this.replacer);return Q}encodeAsBinary(I){let Q=r1(I),$=this.encodeAsString(Q.packet),Z=Q.buffers;return Z.unshift($),Z}}function o1(I){return Object.prototype.toString.call(I)==="[object Object]"}class G1 extends X{constructor(I){super();this.reviver=I}add(I){let Q;if(typeof I==="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");Q=this.decodeString(I);let $=Q.type===O.BINARY_EVENT;if($||Q.type===O.BINARY_ACK){if(Q.type=$?O.EVENT:O.ACK,this.reconstructor=new e1(Q),Q.attachments===0)super.emitReserved("decoded",Q)}else super.emitReserved("decoded",Q)}else if(f(I)||I.base64){if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");else if(Q=this.reconstructor.takeBinaryData(I),Q)this.reconstructor=null,super.emitReserved("decoded",Q)}else throw new Error("Unknown type: "+I)}decodeString(I){let Q=0,$={type:Number(I.charAt(0))};if(O[$.type]===void 0)throw new Error("unknown packet type "+$.type);if($.type===O.BINARY_EVENT||$.type===O.BINARY_ACK){let J=Q+1;while(I.charAt(++Q)!=="-"&&Q!=I.length);let Y=I.substring(J,Q);if(Y!=Number(Y)||I.charAt(Q)!=="-")throw new Error("Illegal attachments");$.attachments=Number(Y)}if(I.charAt(Q+1)==="/"){let J=Q+1;while(++Q){if(I.charAt(Q)===",")break;if(Q===I.length)break}$.nsp=I.substring(J,Q)}else $.nsp="/";let Z=I.charAt(Q+1);if(Z!==""&&Number(Z)==Z){let J=Q+1;while(++Q){let Y=I.charAt(Q);if(Y==null||Number(Y)!=Y){--Q;break}if(Q===I.length)break}$.id=Number(I.substring(J,Q+1))}if(I.charAt(++Q)){let J=this.tryParse(I.substr(Q));if(G1.isPayloadValid($.type,J))$.data=J;else throw new Error("invalid payload")}return $}tryParse(I){try{return JSON.parse(I,this.reviver)}catch(Q){return!1}}static isPayloadValid(I,Q){switch(I){case O.CONNECT:return o1(Q);case O.DISCONNECT:return Q===void 0;case O.CONNECT_ERROR:return typeof Q==="string"||o1(Q);case O.EVENT:case O.BINARY_EVENT:return Array.isArray(Q)&&(typeof Q[0]==="number"||typeof Q[0]==="string"&&S4.indexOf(Q[0])===-1);case O.ACK:case O.BINARY_ACK:return Array.isArray(Q)}}destroy(){if(this.reconstructor)this.reconstructor.finishedReconstruction(),this.reconstructor=null}}class e1{constructor(I){this.packet=I,this.buffers=[],this.reconPack=I}takeBinaryData(I){if(this.buffers.push(I),this.buffers.length===this.reconPack.attachments){let Q=s1(this.reconPack,this.buffers);return this.finishedReconstruction(),Q}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function F(I,Q,$){return I.on(Q,$),function Z(){I.off(Q,$)}}var v4=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class j extends X{constructor(I,Q,$){super();if(this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=I,this.nsp=Q,$&&$.auth)this.auth=$.auth;if(this._opts=Object.assign({},$),this.io._autoConnect)this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;let I=this.io;this.subs=[F(I,"open",this.onopen.bind(this)),F(I,"packet",this.onpacket.bind(this)),F(I,"error",this.onerror.bind(this)),F(I,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){if(this.connected)return this;if(this.subEvents(),!this.io._reconnecting)this.io.open();if(this.io._readyState==="open")this.onopen();return this}open(){return this.connect()}send(...I){return I.unshift("message"),this.emit.apply(this,I),this}emit(I,...Q){var $,Z,J;if(v4.hasOwnProperty(I))throw new Error('"'+I.toString()+'" is a reserved event name');if(Q.unshift(I),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(Q),this;let Y={type:O.EVENT,data:Q};if(Y.options={},Y.options.compress=this.flags.compress!==!1,typeof Q[Q.length-1]==="function"){let V=this.ids++,U=Q.pop();this._registerAckCallback(V,U),Y.id=V}let K=(Z=($=this.io.engine)===null||$===void 0?void 0:$.transport)===null||Z===void 0?void 0:Z.writable,z=this.connected&&!((J=this.io.engine)===null||J===void 0?void 0:J._hasPingExpired());if(this.flags.volatile&&!K);else if(z)this.notifyOutgoingListeners(Y),this.packet(Y);else this.sendBuffer.push(Y);return this.flags={},this}_registerAckCallback(I,Q){var $;let Z=($=this.flags.timeout)!==null&&$!==void 0?$:this._opts.ackTimeout;if(Z===void 0){this.acks[I]=Q;return}let J=this.io.setTimeoutFn(()=>{delete this.acks[I];for(let K=0;K<this.sendBuffer.length;K++)if(this.sendBuffer[K].id===I)this.sendBuffer.splice(K,1);Q.call(this,new Error("operation has timed out"))},Z),Y=(...K)=>{this.io.clearTimeoutFn(J),Q.apply(this,K)};Y.withError=!0,this.acks[I]=Y}emitWithAck(I,...Q){return new Promise(($,Z)=>{let J=(Y,K)=>{return Y?Z(Y):$(K)};J.withError=!0,Q.push(J),this.emit(I,...Q)})}_addToQueue(I){let Q;if(typeof I[I.length-1]==="function")Q=I.pop();let $={id:this._queueSeq++,tryCount:0,pending:!1,args:I,flags:Object.assign({fromQueue:!0},this.flags)};I.push((Z,...J)=>{if($!==this._queue[0])return;if(Z!==null){if($.tryCount>this._opts.retries){if(this._queue.shift(),Q)Q(Z)}}else if(this._queue.shift(),Q)Q(null,...J);return $.pending=!1,this._drainQueue()}),this._queue.push($),this._drainQueue()}_drainQueue(I=!1){if(!this.connected||this._queue.length===0)return;let Q=this._queue[0];if(Q.pending&&!I)return;Q.pending=!0,Q.tryCount++,this.flags=Q.flags,this.emit.apply(this,Q.args)}packet(I){I.nsp=this.nsp,this.io._packet(I)}onopen(){if(typeof this.auth=="function")this.auth((I)=>{this._sendConnectPacket(I)});else this._sendConnectPacket(this.auth)}_sendConnectPacket(I){this.packet({type:O.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},I):I})}onerror(I){if(!this.connected)this.emitReserved("connect_error",I)}onclose(I,Q){this.connected=!1,delete this.id,this.emitReserved("disconnect",I,Q),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach((I)=>{if(!this.sendBuffer.some(($)=>String($.id)===I)){let $=this.acks[I];if(delete this.acks[I],$.withError)$.call(this,new Error("socket has been disconnected"))}})}onpacket(I){if(I.nsp!==this.nsp)return;switch(I.type){case O.CONNECT:if(I.data&&I.data.sid)this.onconnect(I.data.sid,I.data.pid);else this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case O.EVENT:case O.BINARY_EVENT:this.onevent(I);break;case O.ACK:case O.BINARY_ACK:this.onack(I);break;case O.DISCONNECT:this.ondisconnect();break;case O.CONNECT_ERROR:this.destroy();let $=new Error(I.data.message);$.data=I.data.data,this.emitReserved("connect_error",$);break}}onevent(I){let Q=I.data||[];if(I.id!=null)Q.push(this.ack(I.id));if(this.connected)this.emitEvent(Q);else this.receiveBuffer.push(Object.freeze(Q))}emitEvent(I){if(this._anyListeners&&this._anyListeners.length){let Q=this._anyListeners.slice();for(let $ of Q)$.apply(this,I)}if(super.emit.apply(this,I),this._pid&&I.length&&typeof I[I.length-1]==="string")this._lastOffset=I[I.length-1]}ack(I){let Q=this,$=!1;return function(...Z){if($)return;$=!0,Q.packet({type:O.ACK,id:I,data:Z})}}onack(I){let Q=this.acks[I.id];if(typeof Q!=="function")return;if(delete this.acks[I.id],Q.withError)I.data.unshift(null);Q.apply(this,I.data)}onconnect(I,Q){this.id=I,this.recovered=Q&&this._pid===Q,this._pid=Q,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach((I)=>this.emitEvent(I)),this.receiveBuffer=[],this.sendBuffer.forEach((I)=>{this.notifyOutgoingListeners(I),this.packet(I)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){if(this.subs)this.subs.forEach((I)=>I()),this.subs=void 0;this.io._destroy(this)}disconnect(){if(this.connected)this.packet({type:O.DISCONNECT});if(this.destroy(),this.connected)this.onclose("io client disconnect");return this}close(){return this.disconnect()}compress(I){return this.flags.compress=I,this}get volatile(){return this.flags.volatile=!0,this}timeout(I){return this.flags.timeout=I,this}onAny(I){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(I),this}prependAny(I){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(I),this}offAny(I){if(!this._anyListeners)return this;if(I){let Q=this._anyListeners;for(let $=0;$<Q.length;$++)if(I===Q[$])return Q.splice($,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(I){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(I),this}prependAnyOutgoing(I){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(I),this}offAnyOutgoing(I){if(!this._anyOutgoingListeners)return this;if(I){let Q=this._anyOutgoingListeners;for(let $=0;$<Q.length;$++)if(I===Q[$])return Q.splice($,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(I){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){let Q=this._anyOutgoingListeners.slice();for(let $ of Q)$.apply(this,I.data)}}}function q(I){I=I||{},this.ms=I.min||100,this.max=I.max||1e4,this.factor=I.factor||2,this.jitter=I.jitter>0&&I.jitter<=1?I.jitter:0,this.attempts=0}q.prototype.duration=function(){var I=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var Q=Math.random(),$=Math.floor(Q*this.jitter*I);I=(Math.floor(Q*10)&1)==0?I-$:I+$}return Math.min(I,this.max)|0};q.prototype.reset=function(){this.attempts=0};q.prototype.setMin=function(I){this.ms=I};q.prototype.setMax=function(I){this.max=I};q.prototype.setJitter=function(I){this.jitter=I};class y extends X{constructor(I,Q){var $;super();if(this.nsps={},this.subs=[],I&&typeof I==="object")Q=I,I=void 0;Q=Q||{},Q.path=Q.path||"/socket.io",this.opts=Q,L(this,Q),this.reconnection(Q.reconnection!==!1),this.reconnectionAttempts(Q.reconnectionAttempts||1/0),this.reconnectionDelay(Q.reconnectionDelay||1000),this.reconnectionDelayMax(Q.reconnectionDelayMax||5000),this.randomizationFactor(($=Q.randomizationFactor)!==null&&$!==void 0?$:0.5),this.backoff=new q({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(Q.timeout==null?20000:Q.timeout),this._readyState="closed",this.uri=I;let Z=Q.parser||U1;if(this.encoder=new Z.Encoder,this.decoder=new Z.Decoder,this._autoConnect=Q.autoConnect!==!1,this._autoConnect)this.open()}reconnection(I){if(!arguments.length)return this._reconnection;if(this._reconnection=!!I,!I)this.skipReconnect=!0;return this}reconnectionAttempts(I){if(I===void 0)return this._reconnectionAttempts;return this._reconnectionAttempts=I,this}reconnectionDelay(I){var Q;if(I===void 0)return this._reconnectionDelay;return this._reconnectionDelay=I,(Q=this.backoff)===null||Q===void 0||Q.setMin(I),this}randomizationFactor(I){var Q;if(I===void 0)return this._randomizationFactor;return this._randomizationFactor=I,(Q=this.backoff)===null||Q===void 0||Q.setJitter(I),this}reconnectionDelayMax(I){var Q;if(I===void 0)return this._reconnectionDelayMax;return this._reconnectionDelayMax=I,(Q=this.backoff)===null||Q===void 0||Q.setMax(I),this}timeout(I){if(!arguments.length)return this._timeout;return this._timeout=I,this}maybeReconnectOnOpen(){if(!this._reconnecting&&this._reconnection&&this.backoff.attempts===0)this.reconnect()}open(I){if(~this._readyState.indexOf("open"))return this;this.engine=new g(this.uri,this.opts);let Q=this.engine,$=this;this._readyState="opening",this.skipReconnect=!1;let Z=F(Q,"open",function(){$.onopen(),I&&I()}),J=(K)=>{if(this.cleanup(),this._readyState="closed",this.emitReserved("error",K),I)I(K);else this.maybeReconnectOnOpen()},Y=F(Q,"error",J);if(this._timeout!==!1){let K=this._timeout,z=this.setTimeoutFn(()=>{Z(),J(new Error("timeout")),Q.close()},K);if(this.opts.autoUnref)z.unref();this.subs.push(()=>{this.clearTimeoutFn(z)})}return this.subs.push(Z),this.subs.push(Y),this}connect(I){return this.open(I)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");let I=this.engine;this.subs.push(F(I,"ping",this.onping.bind(this)),F(I,"data",this.ondata.bind(this)),F(I,"error",this.onerror.bind(this)),F(I,"close",this.onclose.bind(this)),F(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(I){try{this.decoder.add(I)}catch(Q){this.onclose("parse error",Q)}}ondecoded(I){C(()=>{this.emitReserved("packet",I)},this.setTimeoutFn)}onerror(I){this.emitReserved("error",I)}socket(I,Q){let $=this.nsps[I];if(!$)$=new j(this,I,Q),this.nsps[I]=$;else if(this._autoConnect&&!$.active)$.connect();return $}_destroy(I){let Q=Object.keys(this.nsps);for(let $ of Q)if(this.nsps[$].active)return;this._close()}_packet(I){let Q=this.encoder.encode(I);for(let $=0;$<Q.length;$++)this.engine.write(Q[$],I.options)}cleanup(){this.subs.forEach((I)=>I()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(I,Q){var $;if(this.cleanup(),($=this.engine)===null||$===void 0||$.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",I,Q),this._reconnection&&!this.skipReconnect)this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;let I=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{let Q=this.backoff.duration();this._reconnecting=!0;let $=this.setTimeoutFn(()=>{if(I.skipReconnect)return;if(this.emitReserved("reconnect_attempt",I.backoff.attempts),I.skipReconnect)return;I.open((Z)=>{if(Z)I._reconnecting=!1,I.reconnect(),this.emitReserved("reconnect_error",Z);else I.onreconnect()})},Q);if(this.opts.autoUnref)$.unref();this.subs.push(()=>{this.clearTimeoutFn($)})}}onreconnect(){let I=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",I)}}var l={};function u(I,Q){if(typeof I==="object")Q=I,I=void 0;Q=Q||{};let $=c1(I,Q.path||"/socket.io"),Z=$.source,J=$.id,Y=$.path,K=l[J]&&Y in l[J].nsps,z=Q.forceNew||Q["force new connection"]||Q.multiplex===!1||K,M;if(z)M=new y(Z,Q);else{if(!l[J])l[J]=new y(Z,Q);M=l[J]}if($.query&&!Q.query)Q.query=$.queryKey;return M.socket($.path,Q)}Object.assign(u,{Manager:y,Socket:j,io:u,connect:u});var p,P4=new Uint8Array(16);function w1(){if(!p){if(p=typeof crypto!=="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!p)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported")}return p(P4)}var G=[];for(let I=0;I<256;++I)G.push((I+256).toString(16).slice(1));function I4(I,Q=0){return G[I[Q+0]]+G[I[Q+1]]+G[I[Q+2]]+G[I[Q+3]]+"-"+G[I[Q+4]]+G[I[Q+5]]+"-"+G[I[Q+6]]+G[I[Q+7]]+"-"+G[I[Q+8]]+G[I[Q+9]]+"-"+G[I[Q+10]]+G[I[Q+11]]+G[I[Q+12]]+G[I[Q+13]]+G[I[Q+14]]+G[I[Q+15]]}var h4=typeof crypto!=="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),F1={randomUUID:h4};function g4(I,Q,$){if(F1.randomUUID&&!Q&&!I)return F1.randomUUID();I=I||{};let Z=I.random||(I.rng||w1)();if(Z[6]=Z[6]&15|64,Z[8]=Z[8]&63|128,Q){$=$||0;for(let J=0;J<16;++J)Q[$+J]=Z[J];return Q}return I4(Z)}var H=g4;var W1={};I1(W1,{IndexedDB:()=>s,ImplementableStorageAdapter:()=>J4,ImplementableNetworkAdapter:()=>Y4,BrowserNetwork:()=>K4});function r(I){return new Promise((Q,$)=>{I.oncomplete=I.onsuccess=()=>Q(I.result),I.onabort=I.onerror=()=>$(I.error)})}function D1(I,Q){let $,Z=()=>{if($)return $;let J=indexedDB.open(I);return J.onupgradeneeded=()=>J.result.createObjectStore(Q),$=r(J),$.then((Y)=>{Y.onclose=()=>$=void 0},()=>{}),$};return(J,Y)=>Z().then((K)=>Y(K.transaction(Q,J).objectStore(Q)))}var V1;function H1(){if(!V1)V1=D1("keyval-store","keyval");return V1}function Q4(I,Q=H1()){return Q("readonly",($)=>r($.get(I)))}function $4(I,Q,$=H1()){return $("readwrite",(Z)=>{return Z.put(Q,I),r(Z.transaction)})}function Z4(I,Q=H1()){return Q("readwrite",($)=>{return $.delete(I),r($.transaction)})}class J4{async set(I,Q){}async get(I,Q){}async remove(I,Q){}}class s{store;constructor(I){this.store=D1("cloudstore-cache",I)}async get(I){return await Q4(I)}async remove(I){return await Z4(I)}async set(I,Q){return await $4(I,Q)}}class Y4{constructor(){}onNetworkUpdate(I){}}class K4{state={online:window.navigator.onLine};constructor(){}onNetworkUpdate(I){window.addEventListener("offline",()=>{this.state.online=!1,I("DISCONNECTED")}),window.addEventListener("online",()=>{this.state.online=!0,I("CONNECTED")}),I(window.navigator.onLine?"CONNECTED":"DISCONNECTED")}}class o{query={id:void 0,filters:[],limit:null};constructor(I){this.query.id=I}orderBy(I,Q){return this.query.orderBy={field:I,direction:Q},this}limit(I){return this.query.limit=I,this}where(I,Q,$){return this.query.filters.push({field:I,op:Q,value:$}),this}get _query(){return this.query}}class t{internal={subscriptions:[]};constructor(I){let Q={id:H(),config:I};this.internal.subscriptions.push(Q),I.socket.on("watchable-change-"+Q.id,($)=>{I.onUpdate($)}),I.socket.emit("watch",{stream:{id:Q.id},watchable:{type:"kn.cloudstore.collection",database:{name:I.database.name??"default"},collection:{name:I.collection.name},query:{structured:{from:{collection:I.collection.name},where:I.filters,orderBy:{field:I.orderBy?.field||"_id",direction:I.orderBy?.direction??"ASCENDING"},limit:I.limit}}}})}}class a{internals;constructor(I){this.internals=I}watch(I,Q){if(!this.internals.collection.exists)throw new Error("Collection doesn't exist");return new t({filters:I._query.filters,socket:this.internals.socket,limit:I._query.limit,orderBy:I._query.orderBy,database:{name:this.internals.database.name},collection:this.internals.collection,onUpdate:Q})}remove(I){let Q=H();return new Promise(($,Z)=>{this.internals.socket.on("delete-cb-"+Q,({status:J,result:Y,error:K})=>{if(J)$(Y);else Z(new Error(K||"Delete failed"));this.internals.socket.removeListener("delete-cb-"+Q)}),this.internals.socket.emit("delete",{type:"kn.cloudstore.document:array",database:{name:this.internals.database.name},collection:{name:this.internals.collection.name},ref:{id:Q},query:{structured:{from:{collection:this.internals.collection.name},where:I._query.filters}}})})}get(I){let Q=H();return new Promise(($,Z)=>{this.internals.socket.on("get-cb-"+Q,({status:J,data:Y,error:K})=>{if(J)$(Y);else Z(new Error(K||"Get failed"));this.internals.socket.removeListener("get-cb-"+Q)}),this.internals.socket.emit("get",{type:"kn.cloudstore.document:array",database:{name:this.internals.database.name},collection:{name:this.internals.collection.name},ref:{id:Q},query:{structured:{from:{collection:this.internals.collection.name},where:I._query.filters}}})})}update(I,Q){let $=H();return new Promise((Z,J)=>{this.internals.socket?.on("update-cb-"+$,({status:Y,result:K,error:z})=>{if(Y)Z(K);else J(new Error(z||"Update failed"));this.internals.socket?.removeListener("update-cb-"+$)}),this.internals.socket?.emit("update",{updatable:{type:"kn.cloudstore.collection",ref:{id:$},database:{name:this.internals.database.name},collection:{name:this.internals.collection.name},query:{structured:{from:{collection:this.internals.collection.name},where:I._query.filters,update:{data:Q}}}}})})}insert(I){let Q=H();return new Promise(($,Z)=>{this.internals.socket?.on("insert-cb-"+Q,({status:Y,result:K,error:z})=>{if(Y)$(K);else Z(new Error(z||"Insert failed"));this.internals.socket?.removeListener("insert-cb-"+Q)});let J=Array.isArray(I)?I.map((Y)=>({data:Y})):[{data:I}];this.internals.socket?.emit("insert",{type:"kn.cloudstore.document:array",database:{name:this.internals.database.name},collection:{name:this.internals.collection.name},ref:{id:Q},options:{},insertions:J})})}}var O4={};class C1{static utils={};internals={socket:void 0,constructorConfig:void 0,connection:{connected:!1,remote:{config:void 0}},contexts:{},cache:{active:"IF_NO_NETWORK",storage:{adapter:new s("_kn.cloudstore.cache.temp.collection")}}};constructor(I){this.internals.socket=u(I.server.uri,{extraHeaders:{authorization:`Bearer ${I.server.access.key}`},query:{tenant_id:I.server.access.tenant_id}}),this.internals.constructorConfig=I,this.internals.cache.storage.adapter=I.cache.storage.adapter}connect(){if(!this.internals.socket)throw new Error("Socket Doesn't Exist");this.internals.socket.emit("config",{database:this.internals.constructorConfig.database.name}),this.internals.socket.on("config-cb",(I)=>{this.internals.connection.connected=!0,this.internals.connection.remote.config=I})}QueryWithCallback(I,Q,$,{cleanup:Z}={cleanup:!0}){return new Promise((J,Y)=>{this.internals.socket?.on($,async(K)=>{if(!K?.error)J(K);else Y(K);if(Z)this.internals.socket?.removeListener($)}),this.internals.socket?.emit(I,Q)})}get query(){let I=H(),Q=new o(I);return this.internals.contexts[I]=Q,Q}collection(I){let Q=H();if(this.internals.socket?.on("collection-cb-"+Q,($)=>{if(!$.exists)throw new Error("Collection: "+$.name+" does not exist?")}),this.internals.socket?.emit("collection",{name:I,ref:{id:Q}}),!this.internals.socket||!this.internals.constructorConfig?.database)return;return new a({database:this.internals.constructorConfig.database,collection:{exists:!0,name:I},socket:this.internals.socket})}get info(){return this.internals}}
